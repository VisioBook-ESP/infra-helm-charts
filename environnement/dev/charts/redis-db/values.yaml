replicaCount: 1
name: redis

image:
  repository: ghcr.io/visiobook-esp/redis
  tag: 7
  pullPolicy: IfNotPresent

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  automount: true
  annotations: {}
  name: ""

# Annotations pour Istio
podAnnotations:
  sidecar.istio.io/inject: "true"
  sidecar.istio.io/proxyCPU: "100m"
  sidecar.istio.io/proxyMemory: "128Mi"

podLabels:
  version: v1
  app: redis

podSecurityContext:
  fsGroup: 999
  runAsUser: 999
  runAsNonRoot: true

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false

service:
  type: ClusterIP
  port: 6379
  targetPort: 6379

  nodePort:
    enabled: false
    port: 30379

resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

livenessProbe:
  enabled: true
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  enabled: true
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

volumes: []
volumeMounts: []

nodeSelector: {}
tolerations: []
affinity: {}

# Configuration Redis
redis:
  auth:
    enabled: false
    password: ""

  config:
    maxmemory: "256mb"
    maxmemory-policy: "allkeys-lru"
    save: "900 1 300 10 60 10000"
    appendonly: "yes"
    appendfsync: "everysec"


  persistence:
    enabled: true
    storageClass: "standard"
    accessMode: ReadWriteOnce
    size: 8Gi

# Configuration Istio
istio:
  enabled: true
  injection: true

  gateway:
    enabled: true
    host: "redis.local"

  connectionPool:
    maxConnections: 100

  mtls:
    enabled: true
    mode: ISTIO_MUTUAL

  peerAuthentication:
    mode: STRICT

  authorizationPolicy:
    enabled: true
    allowedNamespaces:
      - backend
      - api
      - database